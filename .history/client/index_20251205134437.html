<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Simple Multiplayer Client</title>
    <style>
        body {
            font-family: Arial;
            padding: 20px;
        }
        #log {
            margin-top: 20px;
            width: 100%;
            height: 200px;
            border: 1px solid #ccc;
            padding: 10px;
            overflow-y: auto;
            background: #f8f8f8;
        }
        #messageInput {
            width: 80%;
            padding: 8px;
        }
        #sendBtn {
            padding: 8px 12px;
        }
    </style>
</head>
<body>

    <h2>Simple Multiplayer Client</h2>

    <button id="startBtn">Start / Join Game</button>

    <div id="log"></div>

    <br/>

    <input type="text" id="messageInput" placeholder="Type message..." />
    <button id="sendBtn">Send</button>

    <script>
        const logBox = document.getElementById("log");
        const startBtn = document.getElementById("startBtn");
        const sendBtn = document.getElementById("sendBtn");

        let socket = null;
        let gameId = null;
        let playerId = crypto.randomUUID();

        function log(msg) {
            logBox.innerHTML += msg + "<br>";
            logBox.scrollTop = logBox.scrollHeight;
        }

        async function createGame() {
            // Call your backend to create a game
            const res = await fetch("http://localhost:8080/game/create", {
                method: "GET"
            });
            const data = await res.json();

            gameId = data.gameId;
            log("Created Game: " + gameId + " (Code: " + data.code + ")");

            connectWebSocket();
        }

        function connectWebSocket() {
            const wsUrl = `ws://localhost:8080/ws/${gameId}/${playerId}`;
            log("Connecting to: " + wsUrl);

            socket = new WebSocket(wsUrl);

            socket.onopen = () => {
                log("Connected to WebSocket");
            };

            socket.onmessage = (event) => {
                log("Received: " + event.data);
            };

            socket.onclose = () => {
                log("Connection closed");
            };

            socket.onerror = (err) => {
                log("Error: " + err);
            };
        }

        startBtn.addEventListener("click", createGame);

        sendBtn.addEventListener("click", () => {
            if (!socket || socket.readyState !== WebSocket.OPEN) {
                log("WebSocket not connected!");
                return;
            }

            const message = document.getElementById("messageInput").value;
            socket.send(JSON.stringify({ message, from: playerId }));
            log("Sent: " + message);
        });
    </script>

</body>
</html>
